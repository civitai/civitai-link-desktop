name: Build/release Electron app

on: [push]

jobs:
  release:
    runs-on: ${{ matrix.os }}

    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]

    steps:
      - name: Check out Git repository
        uses: actions/checkout@v4

      - name: Install Dependencies
        run: |
          npm --version && node --version
          npm install

      - name: build-linux
        if: matrix.os == 'ubuntu-latest'
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: npm run build:linux

      - name: build-mac
        if: matrix.os == 'macos-latest'
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: npm run build:mac

      - name: build-win
        if: matrix.os == 'windows-latest'
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: npm run build:win

      - name: Sign Artifact with CodeSignTool
        if: matrix.os == 'windows-latest'
        uses: sslcom/esigner-codesign@develop
        with:
          # Sign and timestamp code object.
          command: sign
          # SSL.com account username
          username: 'esigner_demo'
          # SSL.com account password.
          password: 'esignerDemo#1'
          # Credential ID for signing certificate.
          credential_id: '8b072e22-7685-4771-b5c6-48e46614915f'
          # OAuth TOTP Secret (https://www.ssl.com/how-to/automate-esigner-ev-code-signing)
          totp_secret: 'RDXYgV9qju+6/7GnMf1vCbKexXVJmUVr+86Wq/8aIGg='
          # Path of code object to be signed. (DLL, JAR, EXE, MSI files vb... )
          # ${name}-${version}-setup.${ext}
          file_path: ${{ github.workspace }}/dist/test-setup.exe
          # Directory where signed code object(s) will be written.
          # output_path: ${{ github.workspace }}/artifacts
          # Scan code before sign
          malware_block: false
          # Overwrite the existing file
          override: true
          # Environment Name, For Production 'PROD' or For Staging 'TEST'
          environment_name: TEST
          # JVM Max Memory
          jvm_max_memory: 2048M
